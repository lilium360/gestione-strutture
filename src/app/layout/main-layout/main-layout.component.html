<div class="app-layout" [class.dark]="isDarkMode()">
    <aside class="sidebar" [class.collapsed]="isCollapsed()" [class.mobile-open]="isMobileOpen()">
        <div class="sidebar-header">
            <a routerLink="/" class="logo-link">
                @if (isCollapsed()) {
                <svg class="logo-glyph" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250.98 136.38">
                    <path fill="currentColor"
                        d="M169.66,95.49c.58,23.62,26.49,28.64,45.4,22.52,20.24-6.54,20.84-28.37,2.8-37.53-19.65-9.98-65.99-10.93-67.42-40.27-.18-3.73,5.23-2.33,8.2-2.28,13.9.23,9.2,3.62,16.18,10.37,17.18,16.61,67.73,11.79,74.95,41.56,14.21,58.58-102.12,63.34-102.25,5.62h22.13Z" />
                    <path fill="currentColor"
                        d="M129.82,67.49v66.33h-17.7v-33.9c-2.7-.36-4.28,1.9-6.33,3.25-5.84,3.85-39.03,30.65-41.61,30.65h-25.82l69.33-53.07h-42.78v-13.27h64.91Z" />
                    <path fill="currentColor"
                        d="M128.35,43.9h-22.13C87.3-.68,18.63,18.84,19.17,66l-19.17.02C1.3,19.02,33.03-.59,77.52,2.56c25.4,1.8,46.08,15.25,50.83,41.34Z" />
                    <path fill="currentColor"
                        d="M250.79,42.43h-20.65c.11-15.37-13.99-23.94-27.91-25.17l-1.6-14.63c24.86-2.37,50.13,13.03,50.16,39.8Z" />
                </svg>
                } @else {
                <svg class="logo-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 662.5 136.38">
                    <path fill="currentColor"
                        d="M169.66,95.49c.58,23.62,26.49,28.64,45.4,22.52,20.24-6.54,20.84-28.37,2.8-37.53-19.65-9.98-65.99-10.93-67.42-40.27-.18-3.73,5.23-2.33,8.2-2.28,13.9.23,9.2,3.62,16.18,10.37,17.18,16.61,67.73,11.79,74.95,41.56,14.21,58.58-102.12,63.34-102.25,5.62h22.13Z" />
                    <path fill="currentColor"
                        d="M129.82,67.49v66.33h-17.7v-33.9c-2.7-.36-4.28,1.9-6.33,3.25-5.84,3.85-39.03,30.65-41.61,30.65h-25.82l69.33-53.07h-42.78v-13.27h64.91Z" />
                    <path fill="currentColor"
                        d="M128.35,43.9h-22.13C87.3-.68,18.63,18.84,19.17,66l-19.17.02C1.3,19.02,33.03-.59,77.52,2.56c25.4,1.8,46.08,15.25,50.83,41.34Z" />
                    <path fill="currentColor"
                        d="M250.79,42.43h-20.65c.11-15.37-13.99-23.94-27.91-25.17l-1.6-14.63c24.86-2.37,50.13,13.03,50.16,39.8Z" />
                    <path fill="currentColor"
                        d="M299.99,60.09c-3.5,0-6.72-.57-9.65-1.7-2.93-1.13-5.48-2.73-7.66-4.81-2.18-2.07-3.87-4.52-5.06-7.34-1.2-2.82-1.79-5.9-1.79-9.23s.6-6.41,1.79-9.23c1.2-2.82,2.89-5.27,5.1-7.34,2.2-2.07,4.77-3.67,7.72-4.81,2.95-1.13,6.17-1.7,9.68-1.7,3.8,0,7.23.62,10.29,1.86,3.05,1.24,5.63,3.06,7.72,5.45l-5.26,5.13c-1.75-1.75-3.64-3.04-5.67-3.88-2.03-.83-4.26-1.25-6.7-1.25s-4.53.38-6.54,1.15c-2.01.77-3.74,1.86-5.19,3.27-1.45,1.41-2.57,3.08-3.36,5-.79,1.92-1.19,4.04-1.19,6.34s.39,4.36,1.19,6.28c.79,1.92,1.91,3.6,3.36,5.03,1.45,1.43,3.16,2.53,5.13,3.3,1.97.77,4.14,1.15,6.54,1.15,2.22,0,4.37-.35,6.44-1.06,2.07-.71,4.05-1.89,5.93-3.56l4.74,6.22c-2.35,1.88-5.07,3.3-8.17,4.26-3.1.96-6.23,1.44-9.39,1.44ZM317.56,54.38l-7.88-1.09v-16.79h7.88v17.88Z" />
                    <path fill="currentColor"
                        d="M328.51,59.45V14.58h32.75v6.99h-24.42v30.89h25.32v6.99h-33.65ZM336.21,40.09v-6.86h22.3v6.86h-22.3Z" />
                    <path fill="currentColor"
                        d="M385.36,60.09c-3.5,0-6.86-.5-10.06-1.51-3.2-1-5.75-2.3-7.63-3.88l2.88-6.47c1.79,1.41,4.02,2.59,6.67,3.52,2.65.94,5.36,1.41,8.14,1.41,2.35,0,4.25-.26,5.7-.77,1.45-.51,2.52-1.21,3.2-2.08.68-.87,1.03-1.87,1.03-2.98,0-1.37-.49-2.47-1.47-3.3-.98-.83-2.25-1.5-3.81-1.99-1.56-.49-3.29-.95-5.19-1.38-1.9-.43-3.8-.93-5.7-1.51-1.9-.58-3.63-1.32-5.19-2.24-1.56-.92-2.83-2.15-3.81-3.69-.98-1.54-1.47-3.5-1.47-5.9s.65-4.67,1.95-6.7c1.3-2.03,3.29-3.65,5.96-4.87s6.06-1.83,10.16-1.83c2.69,0,5.36.34,8.01,1.03,2.65.68,4.96,1.67,6.92,2.95l-2.63,6.47c-2.01-1.2-4.08-2.08-6.22-2.66s-4.19-.87-6.15-.87c-2.31,0-4.18.28-5.61.83-1.43.56-2.48,1.28-3.14,2.18-.66.9-.99,1.92-.99,3.08,0,1.37.48,2.47,1.44,3.3.96.83,2.22,1.48,3.78,1.95,1.56.47,3.3.93,5.22,1.38,1.92.45,3.83.95,5.74,1.51s3.63,1.28,5.19,2.18c1.56.9,2.82,2.11,3.78,3.65.96,1.54,1.44,3.48,1.44,5.83s-.65,4.6-1.95,6.63c-1.3,2.03-3.3,3.65-5.99,4.87-2.69,1.22-6.09,1.83-10.19,1.83Z" />
                    <path fill="currentColor" d="M420.23,59.45V21.63h-14.87v-7.05h38.07v7.05h-14.87v37.81h-8.33Z" />
                    <path fill="currentColor" d="M449.71,59.45V14.58h8.33v44.86h-8.33Z" />
                    <path fill="currentColor"
                        d="M491.18,60.09c-3.5,0-6.73-.58-9.68-1.73s-5.51-2.77-7.69-4.84c-2.18-2.07-3.87-4.51-5.06-7.31-1.2-2.8-1.79-5.86-1.79-9.2s.6-6.4,1.79-9.2c1.2-2.8,2.89-5.23,5.06-7.31,2.18-2.07,4.74-3.69,7.69-4.84s6.15-1.73,9.61-1.73,6.72.58,9.65,1.73c2.93,1.15,5.48,2.77,7.66,4.84,2.18,2.07,3.87,4.51,5.06,7.31,1.2,2.8,1.79,5.86,1.79,9.2s-.6,6.41-1.79,9.23c-1.2,2.82-2.88,5.26-5.06,7.31-2.18,2.05-4.73,3.65-7.66,4.81-2.93,1.15-6.12,1.73-9.58,1.73ZM491.11,52.78c2.26,0,4.36-.38,6.28-1.15,1.92-.77,3.59-1.87,5-3.3,1.41-1.43,2.51-3.1,3.3-5,.79-1.9,1.18-4.01,1.18-6.31s-.39-4.41-1.18-6.31c-.79-1.9-1.89-3.57-3.3-5-1.41-1.43-3.08-2.53-5-3.3-1.92-.77-4.02-1.15-6.28-1.15s-4.35.38-6.25,1.15c-1.9.77-3.57,1.87-5,3.3s-2.54,3.1-3.33,5c-.79,1.9-1.19,4.01-1.19,6.31s.39,4.36,1.19,6.28c.79,1.92,1.89,3.6,3.3,5.03,1.41,1.43,3.08,2.53,5,3.3,1.92.77,4.02,1.15,6.28,1.15Z" />
                    <path fill="currentColor"
                        d="M524.12,59.45V14.58h6.86l28.14,34.55h-3.4V14.58h8.27v44.86h-6.86l-28.14-34.55h3.4v34.55h-8.27Z" />
                    <path fill="currentColor"
                        d="M576.04,59.45V14.58h32.75v6.99h-24.42v30.89h25.32v6.99h-33.65ZM583.73,40.09v-6.86h22.3v6.86h-22.3Z" />
                    <path fill="currentColor"
                        d="M293.52,124.68c-3.5,0-6.86-.5-10.06-1.51-3.2-1-5.75-2.3-7.63-3.88l2.88-6.47c1.79,1.41,4.02,2.59,6.67,3.52,2.65.94,5.36,1.41,8.14,1.41,2.35,0,4.25-.26,5.7-.77,1.45-.51,2.52-1.21,3.2-2.08.68-.87,1.03-1.87,1.03-2.98,0-1.37-.49-2.47-1.47-3.3-.98-.83-2.25-1.5-3.81-1.99-1.56-.49-3.29-.95-5.19-1.38-1.9-.43-3.8-.93-5.7-1.51-1.9-.58-3.63-1.32-5.19-2.24-1.56-.92-2.83-2.15-3.81-3.69-.98-1.54-1.47-3.5-1.47-5.9s.65-4.67,1.95-6.7c1.3-2.03,3.29-3.65,5.96-4.87,2.67-1.22,6.06-1.83,10.16-1.83,2.69,0,5.36.34,8.01,1.03,2.65.68,4.96,1.67,6.92,2.95l-2.63,6.47c-2.01-1.2-4.08-2.08-6.22-2.66-2.14-.58-4.19-.87-6.15-.87-2.31,0-4.18.28-5.61.83-1.43.56-2.48,1.28-3.14,2.18-.66.9-.99,1.92-.99,3.08,0,1.37.48,2.47,1.44,3.3.96.83,2.22,1.48,3.78,1.95,1.56.47,3.3.93,5.22,1.38,1.92.45,3.83.95,5.74,1.51,1.9.56,3.63,1.28,5.19,2.18,1.56.9,2.82,2.11,3.78,3.65.96,1.54,1.44,3.48,1.44,5.83s-.65,4.6-1.95,6.63c-1.3,2.03-3.3,3.65-5.99,4.87-2.69,1.22-6.09,1.83-10.19,1.83Z" />
                    <path fill="currentColor" d="M328.39,124.03v-37.81h-14.87v-7.05h38.07v7.05h-14.87v37.81h-8.33Z" />
                    <path fill="currentColor"
                        d="M357.87,124.03v-44.86h18.39c5.98,0,10.67,1.41,14.07,4.23s5.1,6.73,5.1,11.73c0,3.29-.77,6.12-2.31,8.49-1.54,2.37-3.73,4.19-6.57,5.45-2.84,1.26-6.25,1.89-10.22,1.89h-13.84l3.72-3.78v16.86h-8.33ZM366.2,108.08l-3.72-3.97h13.46c3.67,0,6.44-.79,8.3-2.37,1.86-1.58,2.79-3.78,2.79-6.6s-.93-5.06-2.79-6.6c-1.86-1.54-4.63-2.31-8.3-2.31h-13.46l3.72-4.1v25.96ZM387.22,124.03l-11.34-16.28h8.91l11.41,16.28h-8.97Z" />
                    <path fill="currentColor"
                        d="M424.01,124.68c-6.15,0-10.97-1.73-14.45-5.19-3.48-3.46-5.22-8.46-5.22-15v-25.32h8.33v25c0,4.61.99,7.97,2.98,10.06,1.99,2.09,4.8,3.14,8.43,3.14s6.43-1.05,8.4-3.14c1.96-2.09,2.95-5.45,2.95-10.06v-25h8.2v25.32c0,6.54-1.74,11.54-5.22,15s-8.28,5.19-14.39,5.19Z" />
                    <path fill="currentColor" d="M463.56,124.03v-37.81h-14.87v-7.05h38.07v7.05h-14.87v37.81h-8.33Z" />
                    <path fill="currentColor" d="M502.78,124.03v-37.81h-14.87v-7.05h38.07v7.05h-14.87v37.81h-8.33Z" />
                    <path fill="currentColor"
                        d="M550.72,124.68c-6.15,0-10.97-1.73-14.45-5.19-3.48-3.46-5.22-8.46-5.22-15v-25.32h8.33v25c0,4.61.99,7.97,2.98,10.06,1.99,2.09,4.8,3.14,8.43,3.14s6.43-1.05,8.4-3.14c1.96-2.09,2.95-5.45,2.95-10.06v-25h8.2v25.32c0,6.54-1.74,11.54-5.22,15s-8.28,5.19-14.39,5.19Z" />
                    <path fill="currentColor"
                        d="M582,124.03v-44.86h18.39c5.98,0,10.67,1.41,14.07,4.23s5.1,6.73,5.1,11.73c0,3.29-.77,6.12-2.31,8.49-1.54,2.37-3.73,4.19-6.57,5.45-2.84,1.26-6.25,1.89-10.22,1.89h-13.84l3.72-3.78v16.86h-8.33ZM590.33,108.08l-3.72-3.97h13.46c3.67,0,6.44-.79,8.3-2.37,1.86-1.58,2.79-3.78,2.79-6.6s-.93-5.06-2.79-6.6-4.63-2.31-8.3-2.31h-13.46l3.72-4.1v25.96ZM611.35,124.03l-11.34-16.28h8.91l11.41,16.28h-8.97Z" />
                    <path fill="currentColor"
                        d="M628.85,124.03v-44.86h32.75v6.99h-24.42v30.89h25.32v6.99h-33.65ZM636.54,104.68v-6.86h22.3v6.86h-22.3Z" />
                </svg>
                }
            </a>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                @if (!isCollapsed()) {
                <span class="nav-section-title">Menu</span>
                }
                @for (item of navItems; track item.path) {
                <a [routerLink]="item.path" routerLinkActive="active"
                    [routerLinkActiveOptions]="{ exact: item.path === '/' }" class="nav-item"
                    [title]="isCollapsed() ? item.label : ''" (click)="closeMobileMenu()">
                    <span class="nav-icon">
                        <lucide-icon [name]="item.icon === 'building' ? 'building-2' : item.icon"
                            [size]="20"></lucide-icon>
                    </span>
                    @if (!isCollapsed()) {
                    <span class="nav-label">{{ item.label }}</span>
                    }
                </a>
                }
            </div>
        </nav>

        <div class="sidebar-footer">
            @if (!isCollapsed()) {
            <div class="app-version">
                <span class="version-label">Gestione Strutture</span>
                <span class="version-number">v1.0.0</span>
            </div>
            }
        </div>
    </aside>

    <div class="mobile-overlay" [class.visible]="isMobileOpen()" (click)="closeMobileMenu()"></div>

    <div class="main-wrapper">
        <header class="topbar">
            <div class="topbar-left">
                <button class="topbar-btn" (click)="toggleSidebarOrMobile()"
                    [attr.aria-label]="isCollapsed() ? 'Expand sidebar' : 'Collapse sidebar'">
                    <lucide-icon name="panel-left" [size]="20"></lucide-icon>
                </button>
            </div>

            <div class="topbar-right">
                <button class="topbar-btn theme-toggle" (click)="toggleTheme()"
                    [attr.aria-label]="isDarkMode() ? 'Switch to light mode' : 'Switch to dark mode'">
                    @if (isDarkMode()) {
                    <lucide-icon name="sun" [size]="20"></lucide-icon>
                    } @else {
                    <lucide-icon name="moon" [size]="20"></lucide-icon>
                    }
                </button>

                <div class="user-avatar">
                    <span>U</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            <router-outlet />
        </main>
    </div>
</div>