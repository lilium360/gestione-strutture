import{A as o,e as c,h as i,k as l,n as S,na as p,r as h,za as g}from"./chunk-J337Y4CE.js";import{a as s,b as u}from"./chunk-FDERIQAA.js";var v={spaces:[],selectedSpace:null,loading:!1,error:null},f=class d{http=h(g);apiUrl="api/spaces";_state=o(v);spaces=p(()=>this._state().spaces);selectedSpace=p(()=>this._state().selectedSpace);loading=p(()=>this._state().loading);error=p(()=>this._state().error);isEmpty=p(()=>!this._state().loading&&this._state().spaces.length===0);currentStructureId=o(null);searchTerm=o("");filteredSpaces=p(()=>{let e=this.currentStructureId(),t=this.searchTerm().toLowerCase(),a=this.spaces();return e&&(a=a.filter(r=>r.structureId===e)),t&&(a=a.filter(r=>r.name.toLowerCase().includes(t)||r.type.toLowerCase().includes(t))),a});loadSpaces(){this.updateState({loading:!0,error:null}),this.http.get(this.apiUrl).pipe(l(e=>this.updateState({spaces:e,loading:!1})),i(e=>(this.updateState({error:"Failed to load spaces",loading:!1}),c([])))).subscribe()}loadSpacesByStructure(e){this.currentStructureId.set(e),this.updateState({loading:!0,error:null}),this.http.get(this.apiUrl).pipe(l(t=>{let a=t.filter(r=>r.structureId===e);this.updateState({spaces:t,loading:!1})}),i(t=>(this.updateState({error:"Failed to load spaces",loading:!1}),c([])))).subscribe()}loadSpace(e){this.updateState({loading:!0,error:null}),this.http.get(`${this.apiUrl}/${e}`).pipe(l(t=>this.updateState({selectedSpace:t,loading:!1})),i(t=>(this.updateState({error:"Failed to load space",loading:!1}),c(null)))).subscribe()}createSpace(e){this.updateState({loading:!0,error:null});let t=u(s({},e),{featureIds:e.featureIds||[],createdAt:new Date,updatedAt:new Date});return this.http.post(this.apiUrl,t).pipe(l(a=>{this.updateState({spaces:[...this._state().spaces,a],loading:!1})}),i(a=>{throw this.updateState({error:"Failed to create space",loading:!1}),a}))}updateSpace(e,t){this.updateState({loading:!0,error:null});let a=u(s({},t),{id:e,updatedAt:new Date});return this.http.put(`${this.apiUrl}/${e}`,a).pipe(l(()=>{let r=this._state().spaces.map(n=>n.id===e?s(s({},n),a):n);this.updateState({spaces:r,selectedSpace:this._state().selectedSpace?.id===e?s(s({},this._state().selectedSpace),a):this._state().selectedSpace,loading:!1})}),i(r=>{throw this.updateState({error:"Failed to update space",loading:!1}),r}))}deleteSpace(e){return this.updateState({loading:!0,error:null}),this.http.delete(`${this.apiUrl}/${e}`).pipe(l(()=>{let t=this._state().spaces.filter(a=>a.id!==e);this.updateState({spaces:t,selectedSpace:this._state().selectedSpace?.id===e?null:this._state().selectedSpace,loading:!1})}),i(t=>{throw this.updateState({error:"Failed to delete space",loading:!1}),t}))}selectSpace(e){this.updateState({selectedSpace:e})}setCurrentStructure(e){this.currentStructureId.set(e)}setSearchTerm(e){this.searchTerm.set(e)}clearError(){this.updateState({error:null})}updateState(e){this._state.update(t=>s(s({},t),e))}static \u0275fac=function(t){return new(t||d)};static \u0275prov=S({token:d,factory:d.\u0275fac,providedIn:"root"})};export{f as a};
