import{A as p,e as n,h as s,k as i,n as h,na as a,r as S,za as g}from"./chunk-J337Y4CE.js";import{a as u,b as d}from"./chunk-FDERIQAA.js";var m={structures:[],selectedStructure:null,loading:!1,error:null},f=class l{http=S(g);apiUrl="api/structures";_state=p(m);structures=a(()=>this._state().structures);selectedStructure=a(()=>this._state().selectedStructure);loading=a(()=>this._state().loading);error=a(()=>this._state().error);isEmpty=a(()=>!this._state().loading&&this._state().structures.length===0);searchTerm=p("");filteredStructures=a(()=>{let t=this.searchTerm().toLowerCase();return t?this.structures().filter(e=>e.name.toLowerCase().includes(t)||e.city.toLowerCase().includes(t)||e.address.toLowerCase().includes(t)):this.structures()});loadStructures(){this.updateState({loading:!0,error:null}),this.http.get(this.apiUrl).pipe(i(t=>this.updateState({structures:t,loading:!1})),s(t=>(this.updateState({error:"Failed to load structures",loading:!1}),n([])))).subscribe()}loadStructure(t){this.updateState({loading:!0,error:null}),this.http.get(`${this.apiUrl}/${t}`).pipe(i(e=>this.updateState({selectedStructure:e,loading:!1})),s(e=>(this.updateState({error:"Failed to load structure",loading:!1}),n(null)))).subscribe()}createStructure(t){this.updateState({loading:!0,error:null});let e=d(u({},t),{createdAt:new Date,updatedAt:new Date});return this.http.post(this.apiUrl,e).pipe(i(r=>{this.updateState({structures:[...this._state().structures,r],loading:!1})}),s(r=>{throw this.updateState({error:"Failed to create structure",loading:!1}),r}))}updateStructure(t,e){this.updateState({loading:!0,error:null});let r=d(u({},e),{id:t,updatedAt:new Date});return this.http.put(`${this.apiUrl}/${t}`,r).pipe(i(()=>{let o=this._state().structures.map(c=>c.id===t?u(u({},c),r):c);this.updateState({structures:o,selectedStructure:this._state().selectedStructure?.id===t?u(u({},this._state().selectedStructure),r):this._state().selectedStructure,loading:!1})}),s(o=>{throw this.updateState({error:"Failed to update structure",loading:!1}),o}))}deleteStructure(t){return this.updateState({loading:!0,error:null}),this.http.delete(`${this.apiUrl}/${t}`).pipe(i(()=>{let e=this._state().structures.filter(r=>r.id!==t);this.updateState({structures:e,selectedStructure:this._state().selectedStructure?.id===t?null:this._state().selectedStructure,loading:!1})}),s(e=>{throw this.updateState({error:"Failed to delete structure",loading:!1}),e}))}selectStructure(t){this.updateState({selectedStructure:t})}setSearchTerm(t){this.searchTerm.set(t)}clearError(){this.updateState({error:null})}updateState(t){this._state.update(e=>u(u({},e),t))}static \u0275fac=function(e){return new(e||l)};static \u0275prov=h({token:l,factory:l.\u0275fac,providedIn:"root"})};export{f as a};
