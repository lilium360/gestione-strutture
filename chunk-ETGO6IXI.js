import{a as K}from"./chunk-MPOD3TBQ.js";import{a as Z}from"./chunk-U2TOJW7X.js";import{a as B}from"./chunk-C2AJT47N.js";import{a as j,b as U}from"./chunk-AOWNFRET.js";import{a as W,b as H,c as N,d as Q,t as q}from"./chunk-XVVISF6R.js";import{$ as T,A as S,C as y,Ca as z,D as o,Ea as A,Fa as V,G as F,K as g,N as s,P as m,R as D,S as E,T as a,U as n,V as p,W as b,X as C,Y as c,aa as M,ba as O,ca as P,da as r,ea as u,fa as w,ha as I,ia as k,ib as R,jb as $,r as f,ra as L,u as x,v as h}from"./chunk-J337Y4CE.js";import{d as J}from"./chunk-FDERIQAA.js";var _=J(K());var X=["mapContainer"],ee=()=>["edit"],te=i=>["/structures",i,"spaces","new"],G=(i,t)=>t.id;function ie(i,t){i&1&&p(0,"app-loading-state",2)}function ne(i,t){if(i&1){let e=b();a(0,"app-error-state",5),C("retry",function(){x(e);let d=c();return h(d.loadData())}),n()}if(i&2){let e=c();s("message",e.structuresFacade.error()||void 0)}}function ae(i,t){if(i&1&&(a(0,"div",19)(1,"span",17),r(2,"Description"),n(),a(3,"span",18),r(4),n()()),i&2){let e=c(2);o(4),u(e.structure().description)}}function oe(i,t){if(i&1&&(a(0,"div",16)(1,"span",17),r(2,"Opening Hours"),n(),a(3,"span",18),r(4),n()()),i&2){let e=c(2);o(4),u(e.structure().openingHours)}}function re(i,t){if(i&1&&(a(0,"div",16)(1,"span",17),r(2,"Phone"),n(),a(3,"span",18)(4,"a",29),r(5),n()()()),i&2){let e=c(2);o(4),T("href","tel:",e.structure().phone,"",y),o(),u(e.structure().phone)}}function le(i,t){if(i&1&&(a(0,"div",16)(1,"span",17),r(2,"Email"),n(),a(3,"span",18)(4,"a",29),r(5),n()()()),i&2){let e=c(2);o(4),T("href","mailto:",e.structure().email,"",y),o(),u(e.structure().email)}}function ce(i,t){i&1&&(a(0,"p",20),r(1,"No contact details available"),n())}function se(i,t){i&1&&p(0,"app-loading-state",26)}function pe(i,t){i&1&&p(0,"app-empty-state",27)}function de(i,t){if(i&1&&(a(0,"span",37),p(1,"lucide-icon",44),r(2),n()),i&2){let e=c().$implicit;o(),s("size",14),o(),w(" ",e.capacity," ")}}function me(i,t){if(i&1&&(a(0,"span",37),r(1),n()),i&2){let e=c().$implicit;o(),w("Floor ",e.floor,"")}}function ue(i,t){if(i&1&&(a(0,"span",39),r(1),n()),i&2){let e=t.$implicit;o(),u(e.name)}}function _e(i,t){if(i&1){let e=b();a(0,"div",30)(1,"div",31),p(2,"lucide-icon",32),n(),a(3,"div",33)(4,"span",34),r(5),n(),a(6,"span",35),r(7),n()(),a(8,"div",36),g(9,de,3,2,"span",37)(10,me,2,1,"span",37),n(),a(11,"div",38),D(12,ue,2,1,"span",39,G),n(),a(14,"div",40)(15,"button",41),C("click",function(){let d=x(e).$implicit,v=c(3);return h(v.editSpace(d))}),p(16,"lucide-icon",10),n(),a(17,"button",42),C("click",function(){let d=x(e).$implicit,v=c(3);return h(v.confirmDeleteSpace(d))}),p(18,"lucide-icon",43),n()()()}if(i&2){let e=t.$implicit,l=c(3);o(2),s("size",18),o(3),u(e.name),o(2),u(l.getSpaceTypeLabel(e.type)),o(2),m(e.capacity?9:-1),o(),m(e.floor?10:-1),o(2),E(l.getSpaceFeatures(e)),o(4),s("size",16),o(2),s("size",16)}}function fe(i,t){if(i&1&&(a(0,"div",28),D(1,_e,19,7,"div",30,G),n()),i&2){let e=c(2);o(),E(e.spaces())}}function ge(i,t){if(i&1&&(a(0,"app-page-header",6)(1,"a",7),p(2,"lucide-icon",8),r(3," Back "),n(),a(4,"a",9),p(5,"lucide-icon",10),r(6," Edit "),n()(),a(7,"div",11)(8,"div",12)(9,"div",13)(10,"h3",14),r(11,"General Information"),n(),a(12,"div",15)(13,"div",16)(14,"span",17),r(15,"Address"),n(),a(16,"span",18),r(17),n()(),a(18,"div",16)(19,"span",17),r(20,"City"),n(),a(21,"span",18),r(22),n()(),g(23,ae,5,1,"div",19),n()(),a(24,"div",13)(25,"h3",14),r(26,"Contact Details"),n(),a(27,"div",15),g(28,oe,5,1,"div",16)(29,re,6,3,"div",16)(30,le,6,3,"div",16)(31,ce,2,0,"p",20),n()()(),a(32,"div",21)(33,"h3",14),r(34,"Location"),n(),p(35,"div",22,0),n(),a(37,"div",13)(38,"div",23)(39,"h3",14),r(40,"Spaces"),n(),a(41,"a",24),p(42,"lucide-icon",25),r(43," Add Space "),n()(),g(44,se,1,0,"app-loading-state",26)(45,pe,1,0,"app-empty-state",27)(46,fe,3,0,"div",28),n()()),i&2){let e=c();s("title",e.structure().name),o(2),s("size",16),o(2),s("routerLink",I(14,ee)),o(),s("size",16),o(12),u(e.structure().address),o(5),u(e.structure().city),o(),m(e.structure().description?23:-1),o(5),m(e.structure().openingHours?28:-1),o(),m(e.structure().phone?29:-1),o(),m(e.structure().email?30:-1),o(),m(!e.structure().openingHours&&!e.structure().phone&&!e.structure().email?31:-1),o(10),s("routerLink",k(15,te,e.id)),o(),s("size",14),o(2),m(e.spacesFacade.loading()?44:e.spaces().length===0?45:46)}}var Y=class i{id;mapContainer;structuresFacade=f(B);spacesFacade=f(Z);featuresFacade=f(j);router=f(A);route=f(z);structure=S(null);spaces=S([]);showDeleteDialog=!1;spaceToDelete=null;map=null;ngOnInit(){this.route.params.subscribe(t=>{t.id&&(this.id=t.id,this.loadData())}),this.route.queryParams.subscribe(()=>{this.id&&this.loadData()})}ngAfterViewInit(){}ngOnDestroy(){this.map&&(this.map.remove(),this.map=null)}loadData(){this.structure.set(null),this.map&&(this.map.remove(),this.map=null),this.structuresFacade.loadStructure(this.id),this.spacesFacade.loadSpacesByStructure(this.id),this.featuresFacade.loadFeatures();let t=setInterval(()=>{let l=this.structuresFacade.selectedStructure();l&&l.id===this.id&&(this.structure.set(l),clearInterval(t),this.initMapWithRetry(10))},100),e=setInterval(()=>{let l=this.spacesFacade.filteredSpaces();this.spaces.set(l),this.spacesFacade.loading()||clearInterval(e)},100)}initMapWithRetry(t){t<=0||requestAnimationFrame(()=>{this.mapContainer?.nativeElement&&this.structure()?this.initMap():setTimeout(()=>this.initMapWithRetry(t-1),50)})}initMap(){let t=this.structure();!t||!this.mapContainer?.nativeElement||(this.map&&(this.map.remove(),this.map=null),this.map=_.map(this.mapContainer.nativeElement,{scrollWheelZoom:!1,dragging:!_.Browser.mobile}).setView([t.coordinates.lat,t.coordinates.lng],15),this.map.on("click",()=>{this.map?.scrollWheelZoom.enable()}),this.map.on("mouseout",()=>{this.map?.scrollWheelZoom.disable()}),_.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 OpenStreetMap contributors"}).addTo(this.map),_.marker([t.coordinates.lat,t.coordinates.lng]).addTo(this.map).bindPopup(t.name),setTimeout(()=>{this.map?.invalidateSize()},100))}getSpaceTypeLabel(t){return U[t]||t}getSpaceFeatures(t){return this.featuresFacade.getFeaturesByIds(t.featureIds)}editSpace(t){this.router.navigate(["/structures",this.id,"spaces",t.id,"edit"])}confirmDeleteSpace(t){this.spaceToDelete=t,this.showDeleteDialog=!0}onDeleteSpaceConfirm(){this.spaceToDelete&&this.spacesFacade.deleteSpace(this.spaceToDelete.id).subscribe(()=>{this.spaces.update(t=>t.filter(e=>e.id!==this.spaceToDelete?.id))}),this.onDeleteSpaceCancel()}onDeleteSpaceCancel(){this.showDeleteDialog=!1,this.spaceToDelete=null}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["app-structure-detail"]],viewQuery:function(e,l){if(e&1&&M(X,5),e&2){let d;O(d=P())&&(l.mapContainer=d.first)}},inputs:{id:"id"},decls:5,vars:3,consts:[["mapContainer",""],[1,"page-container"],["message","Loading structure details..."],[3,"message"],["title","Delete Space","confirmText","Delete","variant","destructive",3,"confirm","cancel","isOpen","message"],[3,"retry","message"],["subtitle","Structure Details",3,"title"],["routerLink","/structures",1,"btn","btn-outline"],["name","arrow-left",3,"size"],[1,"btn","btn-primary",3,"routerLink"],["name","pencil",3,"size"],[1,"detail-grid"],[1,"info-section"],[1,"card"],[1,"card-title"],[1,"info-grid"],[1,"info-item"],[1,"info-label"],[1,"info-value"],[1,"info-item","full-width"],[1,"no-data"],[1,"card","map-section"],[1,"map-container"],[1,"card-header"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],["name","plus",3,"size"],["message","Loading spaces..."],["icon","folder","title","No spaces yet","description","Add spaces to this structure"],[1,"spaces-list"],[1,"contact-link",3,"href"],[1,"space-item"],[1,"space-icon"],["name","home",3,"size"],[1,"space-info"],[1,"space-name"],[1,"space-type"],[1,"space-meta"],[1,"meta-item"],[1,"space-features"],[1,"feature-tag"],[1,"space-actions"],["title","Edit",1,"icon-btn",3,"click"],["title","Delete",1,"icon-btn","icon-btn-danger",3,"click"],["name","trash-2",3,"size"],["name","users",3,"size"]],template:function(e,l){e&1&&(a(0,"div",1),g(1,ie,1,0,"app-loading-state",2)(2,ne,1,1,"app-error-state",3)(3,ge,47,17),a(4,"app-confirm-dialog",4),C("confirm",function(){return l.onDeleteSpaceConfirm()})("cancel",function(){return l.onDeleteSpaceCancel()}),n()()),e&2&&(o(),m(l.structuresFacade.loading()?1:l.structuresFacade.error()?2:l.structure()?3:-1),o(3),s("isOpen",l.showDeleteDialog)("message","Are you sure you want to delete "+((l.spaceToDelete==null?null:l.spaceToDelete.name)||"")+"?"))},dependencies:[L,V,$,R,q,W,H,N,Q],styles:[".detail-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.info-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}@media (max-width: 768px){.info-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.info-item.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.info-label[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:hsl(var(--muted-foreground));text-transform:uppercase;letter-spacing:.05em}.info-value[_ngcontent-%COMP%]{font-size:14px;color:hsl(var(--foreground))}.map-section[_ngcontent-%COMP%]{grid-column:1/-1}.spaces-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.space-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;padding:16px;background:hsl(var(--background));border:1px solid hsl(var(--border));border-radius:var(--radius);transition:border-color .15s ease}.space-item[_ngcontent-%COMP%]:hover{border-color:hsl(var(--ring))}.space-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:var(--radius);background:hsl(var(--accent));color:hsl(var(--accent-foreground));display:flex;align-items:center;justify-content:center;flex-shrink:0}.space-info[_ngcontent-%COMP%]{flex:1;min-width:0}.space-name[_ngcontent-%COMP%]{display:block;font-weight:600;color:hsl(var(--foreground))}.space-type[_ngcontent-%COMP%]{font-size:13px;color:hsl(var(--muted-foreground))}.space-meta[_ngcontent-%COMP%]{display:flex;gap:12px;font-size:13px;color:hsl(var(--muted-foreground))}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.space-features[_ngcontent-%COMP%]{display:flex;gap:6px;flex-wrap:wrap}.feature-tag[_ngcontent-%COMP%]{padding:4px 8px;background:hsl(var(--primary));color:hsl(var(--primary-foreground));border-radius:9999px;font-size:11px;font-weight:500}.space-actions[_ngcontent-%COMP%]{display:flex;gap:4px}@media (max-width: 768px){.space-item[_ngcontent-%COMP%]{flex-wrap:wrap}.space-meta[_ngcontent-%COMP%], .space-features[_ngcontent-%COMP%]{width:100%;margin-left:56px}}"],changeDetection:0})};export{Y as StructureDetailComponent};
